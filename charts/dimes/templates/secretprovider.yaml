# SPDX-FileCopyrightText: Copyright Â© 2025 The Dymes project authors
#
# SPDX-License-Identifier: Apache-2.0

{{- $top := . -}}
{{- range $name, $secretprovider := .Values.secretproviders -}}
---
apiVersion: secrets-store.csi.x-k8s.io/v1
kind: SecretProviderClass
metadata:
  name: {{ $name }}
spec:
  provider: {{ $secretprovider.provider | default "aws" }}
  parameters:
    {{- if $secretprovider.region }}
    region: {{ $secretprovider.region }}
    {{ end }}
    {{- if $secretprovider.pathTranslation }}
    pathTranslation: {{ $secretprovider.pathTranslation }}
    {{ end }}
    objects: |
    {{- $secretprovider.objects | toYaml| nindent 6 }}
  {{- if $secretprovider.secretObjects }}
  secretObjects:
    {{- $secretprovider.secretObjects | toYaml| nindent 6 }}
  {{end}}
{{ end }}
